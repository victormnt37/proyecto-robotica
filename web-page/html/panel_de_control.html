<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Control - Kyron</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/panel_de_control.css">
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.min.js"></script>
    <script src="../js/main.js" defer></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/roslib/build/roslib.min.js"></script>


    <script src="https://cdn.jsdelivr.net/npm/easeljs@1/lib/easeljs.min.js"></script>
    <script src=" https://cdn.jsdelivr.net/npm/eventemitter2@6.4.9/lib/eventemitter2.min.js "></script>
    <script src="https://cdn.jsdelivr.net/npm/ros2d@0.10.0/build/ros2d.min.js"></script>
  <!-- <script src="static/js/draw_occupancy_grid.js"></script>-->
    <script src="../js/mapa.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
    

    
</head>

<!-- Bot贸n flotante para abrir el chat -->
<button id="toggle-chat" class="chat-toggle-btn">
    
</button>

<!-- Panel deslizante de chat -->
<aside id="chat-panel" class="chat-popup">
    <div class="chat-popup-header">
        <h2>Conversaci贸n con Paciente</h2>
        <button onclick="toggleChat()" class="chat-close-btn">&times;</button>
    </div>
    <div class="chat-container chat-popup-body">
        <div class="chat-messages">
            <div class="message received">
                <p>驴Podr铆a explicarme el procedimiento?</p>
                <span>10:24 AM</span>
            </div>
            <div class="message sent">
                <p>Claro, es un examen de rutina sin dolor.</p>
                <span>10:25 AM</span>
            </div>
            <!-- M谩s mensajes de ejemplo -->
            <div class="message received">
                <p>驴Necesito alguna preparaci贸n especial?</p>
                <span>10:26 AM</span>
            </div>
            <div class="message sent">
                <p>No, puede comer normalmente antes del examen.</p>
                <span>10:26 AM</span>
            </div>
            <div class="message received">
                <p>驴Cu谩nto tiempo tardar谩n los resultados?</p>
                <span>10:27 AM</span>
            </div>
            <div class="message sent">
                <p>Los resultados estar谩n disponibles en 24-48 horas.</p>
                <span>10:28 AM</span>
            </div>
        </div>
    </div>
</aside>

<body>
    <!-- Header Autenticado -->
    <header class="header">
        <div class="container header-content">
            <a href="/" class="logo">
                <img src="../assets/logo.jpeg" alt="Kyron Robotics" class="logo-img">
                <span class="logo-text">Kyron</span>
            </a>
            <div class="user-panel">
                <div class="user-info">
                    <div class="user-avatar">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                    </div>
                    <span class="user-name">Juanba Peris</span>
                </div>
                <button class="btn btn-header" onclick="window.location.href='../index.html'">
                    <svg viewBox="0 0 24 24">
                        <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                    </svg>
                    Cerrar Sesi贸n
                </button>
            </div>
        </div>
    </header>

    <main class="container">

        <div class="dashboard-layout">
            <!-- Columna Izquierda (30%) -->
            <aside class="sidebar">
                <!-- Secci贸n Estado del Robot -->
                <section class="card robot-status">
                    <h2>Estado del Robot</h2>
                    <div class="status-grid">
                        <div class="status-item">
                            <div class="status-indicator"></div>
                            <div>
                                <h3>Introduce la direcci贸n del rosbridge_server: </h3>
                                <input type="text" name="rosbridge_server" id="rosbridge_server">
                                <br>
                                <button class="mt-2 btn btn-success" id="btn_con">Conectar</button>
                                <button class="mt-2 btn btn-danger" id="btn_dis">Desconectar</button>
                                <br>
                                <br>
                                <p>Estado de la conexion: <span id="estado">Desconectado</span></p>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator active"></div>
                            <div>
                                <h3>Conexi贸n</h3>
                                <p>Estable</p>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator active"></div>
                            <div>
                                <h3>Bater铆a</h3>
                                <p>87%</p>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator"></div>
                            <div>
                                <h3>Posicion actual</h3>
                                <p>
                                    <span>X: <span id="pos_x">...</span>
                                        </span>
                                    <br>
                                        <span>Y: <span id="pos_y">...</span>
                                        </span>
                                </p>
                            </div>
                        </div>
                        <div class="status-item">
                            <div class="status-indicator"></div>
                            <div>
                                <h3>Tarea Actual</h3>
                                <p>En espera</p>
                            </div>
                        </div>
                    </div>
                </section>
            </aside>

            <!-- Columna Derecha (70%) -->
            <div class="main-content">
                <!-- Secci贸n Mapa -->
                <section class="card map-section">
                    <h2>Mapa del Hospital</h2>
                    <div class="map-container">
                        <!-- Espacio reservado para mapa -->
                        <canvas id="mapCanvas"></canvas>
                    </div>
                </section>

                <section class="card camera-section">
                    <div class="control-header">
                        <h2>Control del Robot</h2>
                        <button id="toggle-salas-dropdown" class="boton-verde small">Direcci贸n a salas</button>
                    </div>
                
                    <!-- DESPLEGABLE -->
                    <div id="salas-dropdown" class="salas-dropdown hidden">
                        <div class="salas-scroll">
                            <button class="boton-sala" id="sala-entrada">Entrada</button>
                            <button class="boton-sala" id="sala-recepcion">Recepci贸n</button>
                            <button class="boton-sala" id="sala-5">Sala 5</button>
                            <button class="boton-sala" id="sala-6">Sala 6</button>
                            <button class="boton-sala" id="sala-7">Sala 7</button>
                            <button class="boton-sala" id="sala-8">Sala 8</button>
                            <button class="boton-sala" id="sala-11">Sala 11</button>
                            <button class="boton-sala" id="sala-12">Sala 12</button>
                            <button class="boton-sala" id="sala-16">Sala 16</button>
                            <button class="boton-sala" id="sala-1">Sala 1</button>
                        </div>
                    </div>
                
                    <div class="camera-preview">
                        <div id="divCamera">
                            <img id="cameraFeed" src="http://localhost:8080/stream?topic=/turtlebot3/camera/image_raw">
                        </div>
                    </div>
                
                    <div class="robot-controls">
                        <button class="control-btn boton-verde" id="btn_move">
                            <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                            Mover
                        </button>
                        <button class="control-btn boton-verde" id="btn_stop">
                            <svg viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                            Parar
                        </button>
                        <button class="control-btn boton-verde" id="btn_right">
                            <svg viewBox="0 0 24 24"><path d="M10 17l5-5-5-5v10z"/></svg>
                            Derecha
                        </button>
                        <button class="control-btn boton-verde" id="btn_left">
                            <svg viewBox="0 0 24 24"><path d="M14 7l-5 5 5 5V7z"/></svg>
                            Izquierda
                        </button>
                    </div>
                </section>
                
            </div>
        </div>
    </main>

    <!-- <footer class="main-footer">
        <div class="container footer-content">
            <p class="copyright">Kyron Registration 漏 2025 - Sistema de Gesti贸n Hospitalaria</p>
        </div>
    </footer> -->

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container footer-content">
            <p class="copyright">&copy; 2025 Kyron Registration - Sistema de Gesti贸n Hospitalaria</p>
            <div class="footer-info">
                <span>Contacto: soporte@kyronhealth.com</span>
                <nav class="social-links">
                    <a href="#" class="social-link">LinkedIn</a>
                    <a href="#" class="social-link">Twitter</a>
                </nav>
            </div>
        </div>
    </footer>

    <script>
        document.getElementById("toggle-salas-dropdown").addEventListener("click", () => {
            const dropdown = document.getElementById("salas-dropdown");
            dropdown.classList.toggle("hidden");
        });
    </script>    
    
    <script>
        function toggleChat() {
            const panel = document.getElementById("chat-panel");
            panel.classList.toggle("open");
        }
    
        // Tambi茅n cerrar al presionar bot贸n flotante
        document.getElementById("toggle-chat").addEventListener("click", toggleChat);
    </script>
    
</body>
</html>